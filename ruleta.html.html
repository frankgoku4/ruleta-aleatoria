<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ruleta Aleatoria</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #1a1a1a;
  margin: 0;
  overflow: hidden;
  color: #fff;
}
h1 { margin: 20px 0; color: #ffcc00; }

#entries {
  width: 400px;
  min-height: 200px;
  max-height: 300px;
  margin: 10px auto;
  padding: 10px;
  border: 2px solid #555;
  border-radius: 6px;
  background: rgba(255,255,255,0.1);
  color: #fff;
  overflow-y: auto;
  text-align: left;
  position: relative;
  white-space: pre-wrap;
}
#entries.empty::before {
  content: attr(data-placeholder);
  color: rgba(255,255,255,0.3);
  pointer-events: none;
  position: absolute;
  left: 10px;
  top: 10px;
  font-style: italic;
}

#container { display: flex; justify-content: center; gap: 40px; margin-top: 20px; }
#nameList, #rankingTable {
  width: 220px;
  max-height: 350px;
  border: 2px solid #444;
  border-radius: 8px;
  padding: 10px;
  overflow-y: auto;
  background: rgba(255,255,255,0.1);
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  color: #fff;
}
#nameList div, #rankingTable div {
  padding: 8px;
  margin: 4px 0;
  background: rgba(255,255,255,0.2);
  border-radius: 4px;
  font-weight: bold;
  text-align: center;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#wheelWrapper { position: relative; display: inline-block; }
#wheelCanvas {
  border: 10px solid #333;
  border-radius: 50%;
  background: white;
  box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}
#arrow {
  position: absolute;
  top: 10px; 
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 20px solid transparent;
  border-right: 20px solid transparent;
  border-top: 40px solid red;
  z-index: 10;
}
button {
  margin-top: 10px;
  padding: 8px 15px;
  font-size: 14px;
  border: none;
  border-radius: 6px;
  background: #4CAF50;
  color: white;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  transition: background 0.3s;
}
button:hover { background: #45a049; }
button:disabled { background: gray; cursor: not-allowed; }

canvas#particles {
  position: fixed;
  top: 0;
  left: 0;
  pointer-events: none;
  z-index: 0;
}

#winnerOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.9);
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  color: #fff;
  font-size: 32px;
  z-index: 50;
  display: none;
}
#winnerOverlay canvas#confetti {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
}
#winnerOverlay img, #winnerOverlay #winnerText, #winnerOverlay button {
  z-index: 2;
  position: relative;
}
#winnerOverlay img { width: 180px; margin-bottom: 20px; animation: bounce 1s infinite alternate, shine 2s infinite; }
@keyframes bounce { 0% { transform: translateY(0); } 100% { transform: translateY(-25px); } }
@keyframes shine { 0%,100% { filter: drop-shadow(0 0 10px gold); } 50% { filter: drop-shadow(0 0 25px gold); } }
#winnerText { font-size: 36px; font-weight: bold; color: gold; text-shadow: 0 0 10px #fff, 0 0 20px gold; margin-bottom: 20px; }
</style>
</head>
<body>

<h1>ðŸŽ¡ Ruleta Aleatoria ðŸŽ‰</h1>

<div id="entries" contenteditable="true" spellcheck="false" data-placeholder="James
Emma
John
Thomas
Anna
Sophia
Daniel
Emily
William
Ali
Jessica
Maria
Sarah
David
Michael" class="empty"></div>
<button onclick="loadNames()">Cargar Nombres</button>

<div id="container">
  <div id="nameList"></div>
  <div id="wheelWrapper">
    <div id="arrow"></div>
    <canvas id="wheelCanvas" width="400" height="400"></canvas>
  </div>
  <div id="rankingTable"></div>
</div>

<button onclick="spin()" id="spinBtn">Girar Ruleta</button>

<canvas id="particles"></canvas>

<div id="winnerOverlay">
  <canvas id="confetti"></canvas>
  <img src="https://cdn-icons-png.flaticon.com/512/2583/2583134.png" alt="Trofeo con corona">
  <div id="winnerText"></div>
  <button onclick="resetRoulette()">Repetir Ruleta</button>
</div>

<script>
let names = [];
let ranking = [];
let currentRotation = 0;
let confettiActive = false;

const entriesDiv = document.getElementById("entries");
entriesDiv.addEventListener("input", ()=>{
  if(entriesDiv.innerText.trim()==="") entriesDiv.classList.add("empty");
  else entriesDiv.classList.remove("empty");
});

const particleCanvas = document.getElementById("particles");
const particleCtx = particleCanvas.getContext("2d");
particleCanvas.width = window.innerWidth;
particleCanvas.height = window.innerHeight;
let particles = [];
for (let i=0;i<150;i++){
  particles.push({
    x: Math.random()*particleCanvas.width,
    y: Math.random()*particleCanvas.height,
    radius: Math.random()*2+1,
    speedX:(Math.random()-0.5)*0.5,
    speedY:(Math.random()-0.5)*0.5,
    alpha:Math.random()
  });
}
function updateParticles(){
  particleCtx.clearRect(0,0,particleCanvas.width,particleCanvas.height);
  particles.forEach(p=>{
    p.x+=p.speedX; p.y+=p.speedY;
    if(p.x<0)p.x=particleCanvas.width;
    if(p.x>particleCanvas.width)p.x=0;
    if(p.y<0)p.y=particleCanvas.height;
    if(p.y>particleCanvas.height)p.y=0;
    particleCtx.fillStyle=`rgba(255,255,255,${p.alpha})`;
    particleCtx.beginPath();
    particleCtx.arc(p.x,p.y,p.radius,0,Math.PI*2);
    particleCtx.fill();
  });
  requestAnimationFrame(updateParticles);
}
updateParticles();

const confettiCanvas = document.querySelector("#winnerOverlay canvas#confetti");
const confettiCtx = confettiCanvas.getContext("2d");
confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;
let confettiPieces = [];

const wheelCanvas = document.getElementById("wheelCanvas");
const ctx = wheelCanvas.getContext("2d");
const radius = wheelCanvas.width / 2;

function loadNames(){
  names = [];
  const text = entriesDiv.innerText.trim();
  if(text){
    text.split(/\n|,/).forEach(n=>{
      n=n.trim();
      if(n) names.push(n);
    });
  }
  renderNames();
  drawWheel();
}

function renderNames(){
  const list = document.getElementById("nameList");
  list.innerHTML="";
  names.forEach((n,i)=>{
    const div = document.createElement("div");
    div.textContent = n;
    const removeBtn = document.createElement("button");
    removeBtn.textContent="X";
    removeBtn.onclick=()=>{ names.splice(i,1); renderNames(); drawWheel(); };
    div.appendChild(removeBtn);
    list.appendChild(div);
  });
}

function renderRanking(){
  const table = document.getElementById("rankingTable");
  table.innerHTML="<strong>Lugares:</strong>";
  ranking.slice().reverse().forEach((n,i)=>{
    const div = document.createElement("div");
    div.textContent=`${ranking.length-i}Âº - ${n}`;
    table.appendChild(div);
  });
}

function drawWheel(rotation=0){
  ctx.clearRect(0,0,wheelCanvas.width,wheelCanvas.height);
  if(names.length===0) return;
  const sliceAngle = 2*Math.PI/names.length;
  names.forEach((n,i)=>{
    const angle=i*sliceAngle+rotation;
    ctx.fillStyle=i%2===0?"#ffeb3b":"#8bc34a";
    ctx.beginPath();
    ctx.moveTo(radius,radius);
    ctx.arc(radius,radius,radius,angle,angle+sliceAngle);
    ctx.closePath();
    ctx.fill();
    ctx.stroke();
    ctx.save();
    ctx.translate(radius,radius);
    ctx.rotate(angle+sliceAngle/2);
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillStyle="#000"; // <-- letras en negro
    ctx.font="bold 16px Arial";
    ctx.fillText(n,radius*0.6,0);
    ctx.restore();
  });
}

function spin(){
  if(names.length===0){alert("No hay nombres."); return;}
  const btn=document.getElementById("spinBtn");
  btn.disabled=true;
  const spins=5;
  const finalAngle=spins*360+Math.random()*360;
  let start=null;
  const duration=5000;
  const startRotation=currentRotation;

  function animate(timestamp){
    if(!start) start=timestamp;
    const progress=Math.min((timestamp-start)/duration,1);
    const easeOut=1-Math.pow(1-progress,3);
    const angle=startRotation+easeOut*finalAngle;
    drawWheel(angle*Math.PI/180);
    if(progress<1){requestAnimationFrame(animate);}
    else{
      currentRotation=angle;
      const sliceAngle=2*Math.PI/names.length;
      let adjustedAngle=(currentRotation*Math.PI/180)%(2*Math.PI);
      let index=Math.floor(((2*Math.PI)-adjustedAngle+Math.PI+(Math.PI/2))/sliceAngle)%names.length;
      const eliminated=names[index];
      alert("Â¡Eliminado: "+eliminated+"!");
      ranking.push(eliminated);
      names.splice(index,1);
      renderNames();
      drawWheel();
      renderRanking();
      btn.disabled=false;

      if(names.length===1){
        showWinner(names[0]);
        launchConfetti();
      }
    }
  }
  requestAnimationFrame(animate);
}

function launchConfetti(){
  confettiPieces=[];
  confettiActive=true;
  for(let i=0;i<300;i++){
    confettiPieces.push({
      x:Math.random()*confettiCanvas.width,
      y:Math.random()*confettiCanvas.height-confettiCanvas.height,
      color:`hsl(${Math.random()*360},100%,50%)`,
      size:Math.random()*8+4,
      speed:Math.random()*3+2,
      angle:Math.random()*Math.PI*2
    });
  }
  requestAnimationFrame(updateConfetti);
}

function updateConfetti(){
  confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  if(!confettiActive) return;
  confettiPieces.forEach(p=>{
    p.y+=p.speed;
    p.x+=Math.sin(p.angle)*2;
    if(p.y>confettiCanvas.height){p.y=-10;p.x=Math.random()*confettiCanvas.width;}
    confettiCtx.fillStyle=p.color;
    confettiCtx.fillRect(p.x,p.y,p.size,p.size);
  });
  requestAnimationFrame(updateConfetti);
}

function showWinner(name){
  const overlay=document.getElementById("winnerOverlay");
  document.getElementById("winnerText").textContent="Â¡El ganador es "+name+"!";
  overlay.style.display="flex";
}

function resetRoulette(){
  names=[];
  ranking=[];
  currentRotation=0;
  confettiActive=false;
  renderNames();
  drawWheel();
  entriesDiv.textContent="";
  entriesDiv.classList.add("empty");
  document.getElementById("winnerOverlay").style.display="none";
}
</script>
</body>
</html>
